<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BITSCRY_V1.4_RESURRECTION</title>
    <style>
        :root {
            --white: #FFFFFF; --blue: #0000AA; --red: #AA0000; --cyan: #00AAAA;
            --purple: #AA00AA; --yellow: #FFFF55; --black: #000000; --green: #00AA00;
        }
        body { 
            margin: 0; background-color: #000; 
            font-family: "Courier New", monospace;
            display: flex; justify-content: center; align-items: center; height: 100vh;
        }
        #monitor {
            width: 960px; height: 720px;
            border: 12px ridge var(--cyan); background: var(--white);
            display: grid; grid-template-columns: 280px 1fr; grid-template-rows: 60px 1fr 180px;
            image-rendering: pixelated;
        }
        .panel { border: 2px solid var(--blue); position: relative; overflow: hidden; background: var(--white); }
        .header { background: var(--blue); color: var(--white); font-weight: bold; padding: 4px; text-align: center; font-size: 14px; }
        #top-bar { grid-column: 1 / span 2; background: var(--blue); color: var(--white); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; }
        
        #diff-hud {
            position: absolute; top: 40px; right: 20px; border: 2px solid var(--red);
            padding: 5px; background: var(--white); font-size: 11px; z-index: 10;
        }
        canvas { display: block; width: 100%; height: 100%; }
    </style>
</head>
<body>

<div id="monitor">
    <div id="top-bar">
        <span>TempleOS - BITSCRY_V1.4 - DATA_SYNC_OK</span>
        <span id="clock">00:00:00</span>
    </div>

    <div class="panel" id="sisyphus-panel">
        <div class="header">SISYPHUS.EXE [MEMPOOL]</div>
        <div style="padding: 5px; font-size: 10px; color: var(--red);">UNCONFIRMED_TX: <span id="mempool-val">...</span></div>
        <canvas id="sisyphus-canvas"></canvas>
    </div>

    <div class="panel" id="oracle-panel">
        <div class="header">THE_ASTRONOMICAL_ORACLE</div>
        <div id="diff-hud">
            DIFF: <span id="diff-val" style="color:var(--red)">SYNCING</span><br>
            HOUSE: <span id="house-val" style="color:var(--blue)">ARIES</span>
        </div>
        <canvas id="oracle-canvas"></canvas>
    </div>

    <div class="panel" id="scripture-panel" style="grid-column: 2; padding:10px; border-left:none;">
        <div style="color:var(--purple); font-weight:bold; font-size:12px;">DIVINE_TELEMETRY</div>
        <div id="stats" style="font-size: 11px; margin-top:5px; color: var(--black);">
            PRICE: <span id="price" style="color:var(--red); font-weight:bold;">$0.00</span><br>
            STATUS: <span id="status" style="color:var(--green)">WAITING_FOR_ORACLE</span>
        </div>
    </div>
</div>

<script>
    const sCanvas = document.getElementById('sisyphus-canvas');
    const oCanvas = document.getElementById('oracle-canvas');
    const sCtx = sCanvas.getContext('2d');
    const oCtx = oCanvas.getContext('2d');
    
    let state = {
        price: 0,
        history: [60000, 61000, 60500, 62000, 63000, 62500, 64000, 63500, 65000, 64500, 66000, 65500], // Fallback data
        ticks: 0,
        difficulty: 80000000000000,
        diffScale: 0.005,
        mempool: 0,
        zodiacs: ["♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓"],
        houses: ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"]
    };

    function resize() {
        sCanvas.width = sCanvas.clientWidth; sCanvas.height = sCanvas.clientHeight;
        oCanvas.width = oCanvas.clientWidth; oCanvas.height = oCanvas.clientHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    async function fetchData() {
        try {
            // 1. Fetch Difficulty & Mempool
            const memRes = await fetch('https://mempool.space/api/mempool');
            const memData = await memRes.json();
            state.mempool = memData.count;
            document.getElementById('mempool-val').innerText = state.mempool.toLocaleString();

            const diffRes = await fetch('https://mempool.space/api/blockchain/info');
            const diffData = await diffRes.json();
            state.difficulty = diffData.difficulty || 80e12;
            state.diffScale = Math.min(0.04, (state.difficulty / 1e15) + 0.005);
            document.getElementById('diff-val').innerText = (state.difficulty / 1e12).toFixed(1) + "T";

            // 2. Fetch Price History
            const pRes = await fetch('https://api.exchange.coinbase.com/products/BTC-USD/ticker');
            const pData = await pRes.json();
            state.price = parseFloat(pData.price);
            document.getElementById('price').innerText = "$" + state.price.toLocaleString();
            document.getElementById('status').innerText = "DIVINE_LINK_ESTABLISHED";
            
            // Add current price to history to keep flames alive
            state.history.push(state.price);
            if(state.history.length > 12) state.history.shift();

        } catch (e) {
            console.error("Divine Error:", e);
            document.getElementById('status').innerText = "CONNECTION_WEAK_RETRYING";
        }
    }

    function render() {
        state.ticks++;
        const sw = sCanvas.width, sh = sCanvas.height;
        const ow = oCanvas.width, oh = oCanvas.height;
        const cx = ow/2, cy = oh/2;

        // --- SISYPHUS RENDER ---
        sCtx.fillStyle = "#FFFFFF"; sCtx.fillRect(0,0,sw,sh);
        sCtx.strokeStyle = "#000"; sCtx.lineWidth = 4;
        sCtx.beginPath(); sCtx.moveTo(0, sh-40); sCtx.lineTo(sw, sh-180); sCtx.stroke();
        let sx = (state.ticks * 0.4) % (sw + 60);
        let sy = (sh-40) - (sx * (140/sw));
        sCtx.fillStyle = "#000"; sCtx.font = "bold 20px Courier"; sCtx.fillText("<O/", sx-20, sy-10);
        sCtx.fillStyle = "#AAA"; sCtx.beginPath(); sCtx.arc(sx+30, sy-30, 30, 0, Math.PI*2); sCtx.fill(); sCtx.stroke();

        // --- ORACLE RENDER ---
        oCtx.fillStyle = "#FFFFFF"; oCtx.fillRect(0,0,ow,oh);
        
        const rotation = state.ticks * state.diffScale;
        state.zodiacs.forEach((z, i) => {
            const angle = (i * Math.PI * 2) / 12 + rotation;
            const r = 180;
            const x = cx + Math.cos(angle) * r;
            const y = cy + Math.sin(angle) * r;
            
            const normalizedAngle = (angle % (Math.PI * 2));
            if (normalizedAngle > 4.6 && normalizedAngle < 4.8) {
                oCtx.fillStyle = "#AA0000"; // Red for active house
                document.getElementById('house-val').innerText = state.houses[i].toUpperCase();
            } else {
                oCtx.fillStyle = "#000";
            }
            oCtx.font = "28px serif";
            oCtx.fillText(z, x - 14, y + 14);
        });

        // Menorah Flames
        if(state.history.length > 0) {
            const min = Math.min(...state.history), max = Math.max(...state.history);
            state.history.forEach((p, i) => {
                const x = cx - 110 + (i * 20);
                const val = ((p-min)/(max-min || 1))*60 + 40;
                const y = cy + 40 - val;
                oCtx.fillStyle = "#AA5500"; oCtx.fillRect(x-2, y, 4, val);
                const flic = Math.sin(state.ticks*0.2 + i)*5;
                oCtx.fillStyle = "#FFFF55"; oCtx.beginPath();
                oCtx.moveTo(x, y-10); oCtx.quadraticCurveTo(x-8, y, x, y+20+flic);
                oCtx.quadraticCurveTo(x+8, y, x, y-10); oCtx.fill();
            });
        }

        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        requestAnimationFrame(render);
    }

    // Immediate initial draw then start sync
    resize();
    render();
    fetchData();
    setInterval(fetchData, 15000);
</script>
</body>
</html>
