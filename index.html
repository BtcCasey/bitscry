<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE LEYLINE RITUAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Grenze+Gotisch:wght@400;700&family=IM+Fell+DW+Pica&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0908;
            --mana: #00d4ff;
            --gold: #d4af37;
            --ink: #e3d3a3;
        }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'IM Fell DW Pica', serif; color: var(--ink); }
        
        /* Floating HUD */
        #altar-ui {
            position: absolute; top: 40px; left: 40px; pointer-events: none;
        }
        #price { font-family: 'Grenze Gotisch', serif; font-size: 72px; color: var(--gold); line-height: 1; }
        #hash { font-size: 18px; color: var(--mana); opacity: 0.8; margin-top: 10px; }

        /* The Ritual Log */
        #log {
            position: absolute; bottom: 40px; left: 40px; width: 300px;
            max-height: 200px; overflow: hidden;
            display: flex; flex-direction: column-reverse;
            mask-image: linear-gradient(to top, black 80%, transparent 100%);
        }
        .rune-entry { font-size: 13px; padding: 4px 0; border-bottom: 1px solid rgba(227, 211, 163, 0.1); }
        
        canvas { display: block; }
    </style>
</head>
<body>

<div id="altar-ui">
    <div id="price">℥ ...</div>
    <div id="hash">LEYLINE: CALCULATING EH/S</div>
</div>

<div id="log"></div>
<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    let state = { price: 0, hash: 730_000_000_000_000_000_000n, history: [] };
    let runes = [];

    function resize() {
        canvas.width = window.innerWidth * window.devicePixelRatio;
        canvas.height = window.innerHeight * window.devicePixelRatio;
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    }
    window.addEventListener('resize', resize);
    resize();

    async function init() {
        // Fetch historical data for the "Leyline"
        const candles = await fetch('https://api.exchange.coinbase.com/products/BTC-USD/candles?granularity=300').then(r => r.json());
        state.history = candles.map(c => c[4]).reverse();

        const ws = new WebSocket('wss://ws-feed.exchange.coinbase.com');
        ws.onopen = () => ws.send(JSON.stringify({ type: "subscribe", channels: ["ticker", "matches"], product_ids: ["BTC-USD"] }));
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if (data.type === 'ticker') {
                state.price = parseFloat(data.price);
                document.getElementById('price').innerText = `℥ ${state.price.toLocaleString()}`;
            }
            if (data.type === 'match') {
                // Create a "Rune" particle
                runes.push({
                    x: Math.random() * window.innerWidth,
                    y: Math.random() * window.innerHeight,
                    size: parseFloat(data.size),
                    life: 1.0,
                    color: data.side === 'buy' ? '#00d4ff' : '#ff4b2b'
                });
                const div = document.createElement('div');
                div.className = 'rune-entry';
                div.innerText = `ᚱ ${data.size} @ ${data.price}`;
                document.getElementById('log').prepend(div);
            }
        };
    }

    function render() {
        const w = window.innerWidth, h = window.innerHeight;
        const cx = w/2, cy = h/2;

        // Dark Surface
        ctx.fillStyle = '#0a0908';
        ctx.fillRect(0, 0, w, h);

        // 1. THE LEYLINE (The Data Stream)
        ctx.strokeStyle = 'rgba(212, 175, 55, 0.15)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        const step = w / state.history.length;
        state.history.forEach((p, i) => {
            const x = i * step;
            const y = h * 0.5 + (Math.sin(i * 0.1 + Date.now()*0.001) * 20); // Subtle magical weave
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        });
        ctx.stroke();

        // 2. THE SCRYING ORB (Minimalist Pulse)
        const orbRadius = 150;
        const pulse = Math.sin(Date.now() * 0.002) * 10;
        
        const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, orbRadius + pulse);
        g.addColorStop(0, 'rgba(0, 212, 255, 0.1)');
        g.addColorStop(1, 'transparent');
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(cx, cy, orbRadius + pulse, 0, Math.PI*2); ctx.fill();

        ctx.strokeStyle = 'rgba(0, 212, 255, 0.4)';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 15]);
        ctx.beginPath(); ctx.arc(cx, cy, orbRadius, 0, Math.PI*2); ctx.stroke();
        ctx.setLineDash([]);

        // 3. RUNES (Trade Particles)
        runes = runes.filter(r => {
            ctx.fillStyle = r.color;
            ctx.globalAlpha = r.life;
            // Draw a small diamond rune
            ctx.beginPath();
            ctx.moveTo(r.x, r.y - 10);
            ctx.lineTo(r.x + 10, r.y);
            ctx.lineTo(r.x, r.y + 10);
            ctx.lineTo(r.x - 10, r.y);
            ctx.fill();
            
            // Move toward center orb
            r.x += (cx - r.x) * 0.02;
            r.y += (cy - r.y) * 0.02;
            r.life -= 0.01;
            return r.life > 0;
        });
        ctx.globalAlpha = 1;

        requestAnimationFrame(render);
    }

    init(); render();
</script>
</body>
</html>
